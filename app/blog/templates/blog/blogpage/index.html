{%- extends "blog/blogpage/base.html" -%}

{%- block vars -%}
{{ super() }}
const totalPages = {{ total_pages }};
{%- endblock -%}

{%- block title -%}
{{ blogpage.title }}{%- if page > 1 %} (page {{ page }}){%- endif %}
{{ super() }}
{%- endblock -%}

{%- block content %}
<div class="pt-3 shrinking-font-14">
  <h1 class="blogpage-name">{{ blogpage.title }}</h1>
  {%- if blogpage.subtitle is not none %}
    <h2 class="blogpage-subname mt-2">{{ blogpage.subtitle }}</h2>
  {%- endif %}

  {%- if current_user.is_authenticated %}
    <a class="auth-true btn-custom-orange-deep btn btn-primary mt-1" href="{{ url_for('admin.create_blogpost', blogpage_id=unpublished_blogpage_id) }}" role="button">Create post</a>
  {%- else %}
    <a class="auth-true btn-custom-orange-deep btn btn-primary mt-1" href="{{ url_for('admin.create_blogpost', blogpage_id=unpublished_blogpage_id) }}" role="button" hidden>Create post</a>
  {%- endif %}
</div>
<hr>

<div>
  {%- for post in posts %}
    <div>
      {%- if all_posts %}
        {%- set color = post.blogpage.html_color_class %}
        <a class="{{ color }} underline-{{ color }} underline-on-hover-only shrinking-font-14" href="{{ url_for('blog.' ~ post.blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <div class="d-flex align-items-top">
            <!-- DarkReader doesn't inherit properly if `{{ color }}` not used for `h1`, `h2` -->
            <h1 class="postlist-title {{ color }} flex-basis-80 flex-shrink-0 me-3 mb-0">{{ post.title }}</h1>
            <span class="postlist-blogtitle flex-shrink-9 text-end ms-auto mb-0"> {{ post.blogpage.title }}</span>
          </div>

          {%- if post.subtitle is not none %}
            <div class="d-flex align-items-top mt-1">
                <h2 class="postlist-subtitle {{ color }} flex-basis-80 flex-shrink-0 mb-0">{{ post.subtitle }}</h2>
            </div>
          {%- endif %}

          <div class="d-flex align-items-center mt-2">
            {%- if post.edited_timestamp is not none %}
              <span class="postlist-timestamp flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</span>
            {%- else %}
              <span class="postlist-timestamp flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }}</span>
            {%- endif %}
            <span class="gray d-flex align-items-center ms-auto">
              <span class="me-1">{{ post.get_comment_count() }}</span><img class="img-comment-icon" src="{{ url_for('blog.static', filename='blog/blogpage/images/icon_comment.svg', _external=True) }}" alt="comments">
            </span>
          </div>
      {%- else %}
        <a class="underline-on-hover-only underline-custom-green-deep-dark shrinking-font-14" href="{{ url_for('blog.' ~ blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <h1 class="postlist-title custom-green-deep-dark">{{ post.title }}</h1>

          {%- if post.subtitle is not none %}
            <h2 class="postlist-subtitle custom-orange-deep mt-1">{{ post.subtitle }}</h2>
          {%- endif %}

          <div class="d-flex align-items-center mt-2">
            {%- if post.edited_timestamp is not none %}
              <span class="postlist-timestamp black flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</span>
            {%- else %}
              <span class="postlist-timestamp black flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }}</span>
            {%- endif %}
            <span class="gray d-flex align-items-center ms-auto">
              <span class="me-1">{{ post.get_comment_count() }}</span><img class="img-comment-icon" src="{{ url_for('blog.static', filename='blog/blogpage/images/icon_comment.svg', _external=True) }}" alt="comments">
            </span>
          </div>
      {%- endif %}
        </a>
      </div>
    <hr>
  {%- endfor %}
</div>

{%- if total_pages > 0 %}
  <div class="text-center mx-auto mt-4 mb-4">
    <p class="mb-2">Page {{ page }} of {{ total_pages }}</p>
    <div class="d-flex align-items-center justify-content-center mx-auto">
      {%- if prev_page_url %}
        <a class="link-custom-blue-deep w-2rem text-end" href="{{ prev_page_url }}">--</a>
        <span class="pipe mx-3"></span>
      {%- else %} <!-- to preserve spacing -->
        <a class="link-custom-blue-deep w-2rem text-end invisible">--</a>
        <span class="pipe mx-3 invisible"></span>
      {%- endif %}
    
      <form id="goto-page-form">
        <div class="d-flex align-items-center">
          <div class="mx-0 px-0">
            <input class="form-control" id="page-input" maxlength="5" name="page" type="text" size="1" value="">
          </div>
          <div class="ps-2">
            <input class="btn btn-link btn-custom-blue-deep-link" id="goto-page-form-submit" name="submit" type="submit" value="Go!">
          </div>
        </div>
      </form>
    
      {%- if next_page_url %}
        <span class="pipe mx-3"></span>
        <a class="link-custom-blue-deep w-2rem text-start" href="{{ next_page_url }}">++</a>
      {%- else %}
        <span class="pipe mx-3 invisible"></span>
        <a class="link-custom-blue-deep w-2rem text-start invisible">++</a>
      {%- endif %}
    </div>
  </div>
{%- endif %}
{%- endblock %}
