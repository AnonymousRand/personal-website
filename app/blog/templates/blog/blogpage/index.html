{%- extends "blog/blogpage/base.html" -%}

{%- block vars -%}
{{ super() }}
const totalPages = {{ total_pages }};
{%- endblock -%}

{%- block title -%}
{{ blogpage.title }}{%- if page > 1 %} (page {{ page }}){%- endif %}
{{ super() }}
{%- endblock -%}

{%- block content %}
<div class="pt-3">
  <h1 class="blogpage-name shrinking-font-14">{{ blogpage.title }}</h1>
  {%- if blogpage.subtitle is not none %}
    <h2 class="blogpage-subname shrinking-font-14 mt-2">{{ blogpage.subtitle }}</h2>
  {%- endif %}

  {%- if current_user.is_authenticated %}
    <a class="auth-true btn-custom-orange shrinking-font-14 btn btn-primary mt-1" href="{{ url_for('admin.create_blogpost', blogpage_id=unpublished_blogpage_id) }}" role="button">Create post</a>
  {%- else %}
    <a class="auth-true btn-custom-orange shrinking-font-14 btn btn-primary mt-1" href="{{ url_for('admin.create_blogpost', blogpage_id=unpublished_blogpage_id) }}" role="button" hidden>Create post</a>
  {%- endif %}
</div>
<hr>

<div>
  {%- for post in posts %}
    <div>
      {%- if all_posts %}
        {%- set color = post.blogpage.color_html_class %}
        <a class="underline-on-hover-only underline-{{ color }} shrinking-font-14" href="{{ url_for('blog.' ~ post.blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <div class="d-flex align-items-top">
            <h1 class="postlist-post-title {{ color }} flex-basis-80 flex-shrink-0 me-3 mb-1">{{ post.title }}</h1>
            <h1 class="postlist-post-blogtitle {{ color }} flex-shrink-9 text-end ms-auto"> {{ blogpage.title }}</h1>
          </div>
          {%- if post.subtitle is not none %}
            <div class="d-flex align-items-top">
                <h2 class="postlist-post-subtitle {{ color }} flex-basis-80 flex-shrink-0 mb-1">{{ post.subtitle }}</h2>
            </div>
          {%- endif %}
      {%- else %}
        <a class="underline-on-hover-only underline-custom-green shrinking-font-14" href="{{ url_for('blog.' ~ blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <h1 class="postlist-post-title custom-green mb-1">{{ post.title }}</h1>
          {%- if post.subtitle is not none %}
            <h2 class="postlist-post-subtitle custom-orange mb-1">{{ post.subtitle }}</h2>
          {%- endif %}
      {%- endif %}

          <div class="d-flex align-items-center pt-2">
            {%- if post.edited_timestamp is not none %}
              <h3 class="postlist-post-timestamp black flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</h3>
            {%- else %}
              <h3 class="postlist-post-timestamp black flex-basis-80 me-3 mb-0">{{ moment(post.timestamp).format("l") }}</h3>
            {%- endif %}
            <span class="gray d-flex align-items-center ms-auto">
              <span class="me-1">{{ post.get_comment_count() }}</span><img class="img-comment-icon" src="{{ url_for('blog.static', filename='blog/blogpage/images/comment_icon.svg') }}" alt="comments">
            </span>
          </div>
        </a>
      </div>
    <hr>
  {%- endfor %}
</div>

{%- if total_pages > 0 %}
  <div class="text-center mx-auto mt-4 mb-4">
    <p class="mb-2">Page {{ page }} of {{ total_pages }}</p>
    <div class="d-flex align-items-center justify-content-center mx-auto">
      {%- if prev_page_url %}
        <a class="link-custom-blue" href="{{ prev_page_url }}">--</a>
        <span class="pipe ms-4 me-4"></span>
      {%- else %} <!-- to preserve spacing -->
        <a class="link-custom-blue invisible">--</a>
        <span class="pipe ms-4 me-4 invisible"></span>
      {%- endif %}
    
      <form id="goto-page-form">
        <div class="d-flex align-items-center">
          <div class="mx-0 px-0">
            <input class="form-control" id="page-input" maxlength="5" name="page" type="text" size="1" value="">
          </div>
          <div class="ps-2">
            <input class="btn btn-link btn-custom-blue-link" id="submit" name="submit" type="submit" value="Go!">
          </div>
        </div>
      </form>
    
      {%- if next_page_url %}
        <span class="pipe ms-4 me-4"></span>
        <a class="link-custom-blue" href="{{ next_page_url }}">++</a>
      {%- else %}
        <span class="pipe ms-4 me-4 invisible"></span>
        <a class="link-custom-blue invisible">++</a>
      {%- endif %}
    </div>
  </div>
{%- endif %}
{%- endblock %}
