{%- extends "blog/blogpage/base.html" %}

{%- block title %}
{{ blogpage.name }}{%- if page_num > 1 %} (page {{ page_num }}){%- endif %} - AnonymousRand blogs
{%- endblock %}

{%- block js_inline %}
{{ super() }}
const totalPages = {{ total_pages }};
{%- endblock %}

{%- block content %}
<div class="pt-3">
  <h1 class="blogpage-name fs-1">{{ blogpage.name }}</h1>
  {%- if blogpage.subname is not none %}
    <h2 class="blogpage-subname fs-7 mt-2">{{ blogpage.subname }}</h2>
  {%- endif %}

  <a class="btn btn-primary btn-custom-orange mt-1 auth-true" href="{{ url_for('admin.create_blogpost', blogpage_id=unpublished_blogpage_id) }}" role="button"{%- if not current_user.is_authenticated %} hidden{%- endif %}>Create post</a>
</div>
<hr class="mt-4" />

<div>
  {%- for post in posts %}
    <div>
      {%- if is_all_posts %}
        {%- set color = post.blogpage.html_color_class -%}
        <a class="underline-on-hover-only underline-{{ color }} {{ color }}" href="{{ url_for('blog.' ~ post.blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <div class="d-flex align-items-top">
            <!-- DarkReader doesn't inherit properly if `{{ color }}` not used for `h1`, `h2` -->
            <h1 class="flex-shrink-0 flex-basis-75 me-3 mb-0 {{ color }} fs-5">{{ post.title }}</h1>
            <span class="postlist-blogtitle flex-shrink-9 ms-auto mb-0 text-end"> {{ post.blogpage.name }}</span>
          </div>

          {%- if post.subtitle is not none %}
            <div class="d-flex align-items-top mt-1">
                <h2 class="flex-shrink-0 flex-basis-75 mb-0 {{ color }} fs-8">{{ post.subtitle }}</h2>
            </div>
          {%- endif %}

          <div class="d-flex align-items-center mt-2">
            {%- if post.edited_timestamp is not none %}
              <span class="flex-basis-75 me-3 mb-0">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</span>
            {%- else %}
              <span class="flex-basis-75 me-3 mb-0">{{ moment(post.timestamp).format("l") }}</span>
            {%- endif %}
            <span class="d-flex align-items-center ms-auto gray">
              <span class="me-2">{%- if current_user.is_authenticated and post.get_comment_unread_count() > 0 %}<span class="custom-pink">({{ post.get_comment_unread_count() }})</span> {% endif %}{{ post.get_comment_count() }}</span><i class="postlist-icon-comment bi bi-chat-right-text"></i>
            </span>
          </div>
      {%- else %}
        <a class="underline-on-hover-only underline-custom-green-deep-dark" href="{{ url_for('blog.' ~ blogpage_id ~ '.post', post_sanitized_title=post.sanitized_title) }}">
          <h1 class="mb-0 custom-green-deep-dark fs-5">{{ post.title }}</h1>

          {%- if post.subtitle is not none %}
            <h2 class="mt-1 custom-orange-deep fs-8">{{ post.subtitle }}</h2>
          {%- endif %}

          <div class="d-flex align-items-center mt-2">
            {%- if post.edited_timestamp is not none %}
              <span class="flex-basis-75 me-3 mb-0 black">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</span>
            {%- else %}
              <span class="flex-basis-75 me-3 mb-0 black">{{ moment(post.timestamp).format("l") }}</span>
            {%- endif %}
            <span class="d-flex align-items-center gray ms-auto">
              <span class="me-2">{%- if current_user.is_authenticated and post.get_comment_unread_count() > 0 %}<span class="custom-pink auth-true">({{ post.get_comment_unread_count() }})</span> {% endif %}{{ post.get_comment_count() }}</span><i class="postlist-icon-comment bi bi-chat-right-text"></i>
            </span>
          </div>
      {%- endif %}
        </a>
      </div>
    <hr />
  {%- endfor %}
</div>

{%- if total_pages > 0 %}
  <div class="mx-auto mt-4 mb-4 text-center">
    <p class="mb-3">Page {{ page_num }} of {{ total_pages }}</p>
    <div class="d-flex justify-content-center align-items-center mx-auto">
      {%- if prev_page_url %}
        <a class="no-underline w-2rem text-end" href="{{ prev_page_url }}">--</a>
        <span class="pipe mx-3"></span>
      {%- else %}
        <a class="invisible no-underline w-2rem text-end">--</a>
        <span class="pipe invisible mx-3"></span>
      {%- endif %}
    
      <form id="goto-page-form">
        <div class="d-flex align-items-center">
          <div class="mx-0 px-0">
            <input id="page-input" class="form-control" name="page" type="text" maxlength="5" value="" size="1"/>
          </div>
          <div class="ps-2">
            <input id="goto-page-form-submit" class="btn btn-link no-underline" name="submit" type="submit" value="go :]" />
          </div>
        </div>
      </form>
    
      {%- if next_page_url %}
        <span class="pipe mx-3"></span>
        <a class="no-underline w-2rem text-start" href="{{ next_page_url }}">++</a>
      {%- else %}
        <span class="pipe invisible mx-3"></span>
        <a class="invisible no-underline w-2rem text-start">++</a>
      {%- endif %}
    </div>
  </div>
{%- endif %}
{%- endblock %}
