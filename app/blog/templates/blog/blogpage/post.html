{%- extends "blog/blogpage/base.html" -%}
{%- import "bootstrap_wtf.html" as wtf -%}

{%- block title -%}
{{ post.title }} - {{ blogpage.name }}
{%- endblock -%}

{%- block js_inline -%}
{{ super() }}
const URL_GET_COMMENTS = "{{ url_for('blog.' ~ blogpage_id ~ '.get_comments', post_sanitized_title=post.sanitized_title, _external=True) }}";
const URL_GET_COMMENT_COUNT = "{{ url_for('blog.' ~ blogpage_id ~ '.get_comment_count', post_sanitized_title=post.sanitized_title, _external=True) }}";
const URL_GET_COMMENT_UNREAD_COUNT = "{{ url_for('blog.' ~ blogpage_id ~ '.get_comment_unread_count', post_sanitized_title=post.sanitized_title, _external=True) }}";
const URL_MARK_COMMENTS_AS_READ = "{{ url_for('blog.' ~ blogpage_id ~ '.mark_comments_as_read', post_sanitized_title=post.sanitized_title, _external=True) }}";
const URL_PERMANENT_LINK = "{{ url_for('blog.post_by_id', post_id=post.id, _external=True) }}";
{%- endblock -%}

{%- block js %}
{{ super() }}
<script src="{{ url_for('blog.static', filename='blogpage/js/post_display_customization.js', _external=True) }}" defer></script>
<script src="{{ url_for('blog.static', filename='blogpage/js/post_comments.js', _external=True) }}" defer></script>
{%- endblock %}

{%- block content %}
<div class="pt-2 shrinking-font-14">
  <h1 class="post-title custom-green-deep-dark mb-0">{{ post.title }}</h1>
  {%- if post.subtitle is not none %}
    <h2 class="post-subtitle custom-orange-deep mt-2 mb-0">{{ post.subtitle }}</h2>
  {%- endif %}
  <div class="d-flex align-items-center mt-2half">
    {%- if post.edited_timestamp is not none %}
      <span class="post-timestamp black mb-0">{{ moment(post.timestamp).format("l") }} | Edited {{ moment(post.edited_timestamp).format("l") }}</span>
    {%- else %}
      <span class="post-timestamp black mb-0">{{ moment(post.timestamp).format("l") }}</span>
    {%- endif %}
    <a id="go-to-comments-link" class="me-2" href="#leave-a-comment" title="Go to comments"><i class="bi bi-chat-right-text"></i></a>
    <button type="button" id="copy-permanent-link-btn" class="btn btn-link" title="Copy permanent link"><i class="bi bi-link-45deg"></i></button>
  </div>

  <a class="auth-true btn-custom-orange-deep btn btn-primary mt-2half" href="{{ url_for('admin.edit_blogpost', post_id=post.id) }}" role="button"{%- if not current_user.is_authenticated %} hidden{%- endif %}>Edit/delete post</a>
</div>
<hr />

<div id="post-content" class="mt-2">
  {{ post.content|safe }}
</div>

<hr class="doublehr">

<div id="leave-a-comment">
  <h2 id="leave-a-comment-heading" class="shrinking-font-14">Leave a comment</h2>
  {{ wtf.quick_form(add_comment_form, class="comment-add-form ajax-add-comment", bottom_margin=2, autofocus_first=false) }}
</div>
<hr />

<div class="mb-3">
  <!-- Populate after page load with JS to avoid slow initial loads -->
  <h2 id="comment-list-heading" class="shrinking-font-14 mb-0">Comments <span id="comment-list-heading-counts" class="gray"></span></h2>
  <div id="comment-list" class="d-flex flex-column flex-shrink-0"></div>
</div>
{%- endblock %}
