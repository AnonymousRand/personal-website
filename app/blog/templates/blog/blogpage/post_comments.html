{% import "bootstrap_wtf.html" as wtf %}

{% for comment in comments recursive %}
  {% if comment.depth == loop.depth0 %}
    {% set descendants = comment.get_descendants(post) %}
    {% if comment.author|trim == config["VERIFIED_AUTHOR"] %}
      {% if comment.depth == 0 %}
        <div class="comment card mt-3 border--custom-orange-deep border--3px">
      {% else %}
        <div class="comment card mt-1 ms-3 border--custom-orange-deep border--3px">
      {% endif %}
        <div class="card-body pb-2">
          <h3 class="d-flex align-items-center fs-7">
            <span class="me-2">{{ comment.author }}</span><i class="bi bi-check-circle" title="Actually verified, unlike Twitter."></i>
          </h3>
    {% else %}
      <div class="comment card mt-{% if comment.depth == 0 %}3{% else %}1{% endif %}{% if current_user.is_authenticated and comment.unread %} border--custom-pink-light border--3px{% endif %}">
        <div class="card-body pb-2">
          <h3 class="mb-2 fs-7">{{ comment.author }}</h3>
    {% endif %}
        <div class="comment__content mb-3 gray">{{ comment.content|safe }}</div>
        <div class="mb-1"><small>{{ moment(comment.timestamp).format("lll") }} ({{ moment(comment.timestamp).fromNow() }})</small></div>
        
        {% if comment.depth < 6 %}
          {{ wtf.quick_form(reply_comment_btn, id="comment__reply-btn-" ~ comment.id, class="comment__reply-btn", btn_type="link", btn_color="custom-orange-deep") }}
          {{ wtf.quick_form(add_comment_form, id="comment__add-reply-form-" ~ comment.id, class="ajax-add-comment mb-2", hidden=true) }}
        {% else %}
          <p class="comment__nest-limit-text mb-0 custom-orange-deep">It's gonna get ugly if you keep replyingâ€¦</p>
        {% endif %}

        {% if current_user.is_authenticated %}
          {{ wtf.quick_form(delete_comment_btn, id="comment__delete-form-" ~ comment.id, class="ajax-delete-comment auth-true", btn_type="link", btn_color="custom-pink-light") }}
        {% else %}
          {{ wtf.quick_form(delete_comment_btn, id="comment__delete-form-" ~ comment.id, class="ajax-delete-comment auth-true", btn_type="link", btn_color="custom-pink-light", hidden=true) }}
        {% endif %}
      </div>
    </div>
    {% if descendants %}
      {{ loop(descendants) }}
    {% endif %}
  {% endif %}
{% endfor %}
